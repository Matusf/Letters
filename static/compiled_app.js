"use strict";var _createClass=function(){function c(d,e){for(var g,f=0;f<e.length;f++)g=e[f],g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(d,g.key,g)}return function(d,e,f){return e&&c(d.prototype,e),f&&c(d,f),d}}();function _classCallCheck(c,d){if(!(c instanceof d))throw new TypeError("Cannot call a class as a function")}var Letter=function(){function c(d,e,f,g,h){_classCallCheck(this,c),this.canvas=d,this.char=e,this.x=f,this.y=g,this.colour=h}return _createClass(c,[{key:"moveAndCheck",value:function moveAndCheck(){return this.y+=3,!(this.y>=this.canvas.height)}},{key:"drawLetter",value:function drawLetter(d){d.font="30px Arial",d.fillStyle=this.colour,d.fillText(this.char,this.x,this.y)}}]),c}(),LettersApp=function(){function c(d,e){_classCallCheck(this,c),this.canvas=d,this.leaderboard=e,this.getScore()}return _createClass(c,[{key:"animateStart",value:function animateStart(){if(!this.onGoing){this.onGoing=!0;var d=this,e=this.canvas.getContext("2d"),f=function(g){e.font="100px Arial",e.fillStyle="#FF5722",e.clearRect(0,0,d.canvas.width,d.canvas.height),e.fillText(g,d.canvas.width/2-15,d.canvas.height/2),0<g?setTimeout(function(){f(g-1)},1e3):d.startGame()};f(3)}}},{key:"startGame",value:function startGame(){this.letters=[],this.score=0,this.gameOver=!1,this.generateSpeed=1200,this.scoreTable={},this.letterColours=["#ff0000","#ff0040","#ff8800","#ff0000","#ff4000","#4d0000","#3B5323","#2F4F2F","#008B00","#2E8B57","#5588dd","#457371"],this.getScore(),this.generateLetter(),this.moveLetters()}},{key:"generateLetter",value:function generateLetter(){if(!this.gameOver){var d="QWERTYUIOPASDFGHJKLZXCVBNM",e=d[Math.floor(Math.random()*d.length)],f=Math.floor(Math.random()*this.letterColours.length);this.letters.push(new Letter(this.canvas,e,Math.random()*(this.canvas.width-30),-30,this.letterColours[f]));var g=this;this.generateSpeed-=10,setTimeout(function(){g.generateLetter()},g.generateSpeed)}}},{key:"moveLetters",value:function moveLetters(){if(!this.gameOver){var d=this,e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height),this.letters.forEach(function(f){f.moveAndCheck()||d.endGame(),f.drawLetter(e)}),setTimeout(function(){d.moveLetters()},70)}}},{key:"getPressedKey",value:function getPressedKey(d){if(!this.gameOver){var e=d.keyCode||d.which,f=String.fromCharCode(e).toUpperCase();this.removeLetter(f)}}},{key:"removeLetter",value:function removeLetter(d){var e=this,f=!1;this.letters.forEach(function(g,h){g.char==d&&(e.letters.splice(h,1),e.score+=1,f=!0)}),f||this.endGame()}},{key:"endGame",value:function endGame(){this.gameOver=!0,this.onGoing=!1,$(".display-score").text(this.score),$("#write-score").fadeIn(400)}},{key:"displayLeaderboard",value:function displayLeaderboard(){var d=this;this.scoreTable.sort(function(g,h){return h.score-g.score}),$("table tbody").children().remove();for(var f,e=0;e<d.scoreTable.length;e++)f=$("<tr>").appendTo(d.leaderboard),f.append($("<td>").text(d.scoreTable[e].name)),f.append($("<td>").text(d.scoreTable[e].score))}},{key:"getScore",value:function getScore(){var d=this;$.getJSON("db.json",function(e){d.scoreTable=e,d.displayLeaderboard()})}},{key:"sendScore",value:function sendScore(){var d={name:$("#write-score input").val(),score:this.score};this.scoreTable.push(d);var e=this;$("#write-score").fadeOut(400),$.post("/",d,function(){e.displayLeaderboard()})}},{key:"resizeCanvas",value:function resizeCanvas(){this.canvas.width=Math.min(window.innerWidth,window.innerHeight)-30,this.canvas.height=Math.min(window.innerWidth,window.innerHeight)-30,this.canvas.style.width=Math.min(window.innerWidth,window.innerHeight)-30+"px",this.canvas.style.height=Math.min(window.innerWidth,window.innerHeight)-30+"px"}}]),c}();$(document).ready(function(){var c=document.getElementById("canvas"),d=document.querySelector(".exit-write-score"),e=document.querySelector(".submit"),f=$("#start-button"),g=$("table tbody"),h=new LettersApp(c,g);$(document).keypress(function(j){h.getPressedKey(j)}),f.on("click",function(){h.animateStart()}),d.onclick=function(){$("#write-score").fadeOut(400)},e.onclick=function(){h.sendScore()}});